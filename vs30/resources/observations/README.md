# Measured Vs30 Observational Data

This directory contains prepared observational datasets used for Vs30 mapping. These datasets are created by the script `vs30/temp/export_measured_vs30.py` which consolidates and prepares data from multiple sources.

## Dataset: `measured_vs30_independent_observations.csv`

This file contains **independent observations** that are processed without spatial clustering in the Vs30 mapping pipeline. Each observation is treated individually when updating the categorical models.

### Data Sources

The dataset combines measurements from three sources:

#### 1. McGann et al. (2015)
- **Source**: `sites_load.load_mcgann_vs()`
- **Description**: Surface wave measurements from the Canterbury region
- **Count**: ~400 sites
- **Source label**: `mcgann`

#### 2. Wotherspoon et al. (2015)
- **Source**: `sites_load.load_wotherspoon_vs()`
- **Description**: Additional surface wave measurements from Canterbury
- **Count**: ~40 sites
- **Source label**: `wotherspoon`

#### 3. Kaiser et al. (2017) - Filtered
- **Source**: `sites_load.load_kaiseretal_vs()`
- **Description**: Comprehensive Vs30 dataset for New Zealand
- **Filtering criteria**: Sites are excluded if they meet ALL of these conditions:
  - `q == 3` (quality flag indicating questionable data)
  - `len(station) != 3` (station code is not exactly 3 characters)
- **Rationale**: The filter removes low-quality Kaiseretal sites while preserving stations with 3-letter codes that have quality flag 3
- **Count**: ~400 sites (filtered from ~460 total)
- **Source label**: `kaiseretal`

### Data Structure

All datasets are standardized to the following CSV format:

```csv
easting,northing,vs30,uncertainty,source,station,q
1576480.1104056418,5207643.269430228,224.85387,0.20000000298023224,mcgann,,
1577001.152476283,5207261.8981841365,205.06209,0.20000000298023224,mcgann,,
1933261.1379653357,5620565.339633845,150.0,0.2,kaiseretal,014A,2.0
```

#### Column Descriptions

- **`easting`**: Easting coordinate in NZTM2000 projection (meters)
- **`northing`**: Northing coordinate in NZTM2000 projection (meters)
- **`vs30`**: Measured Vs30 value (m/s)
- **`uncertainty`**: Measurement uncertainty/standard deviation (m/s)
- **`source`**: Data source identifier (`mcgann`, `wotherspoon`, or `kaiseretal`)
- **`station`**: Station identifier (primarily from Kaiseretal data)
- **`q`**: Quality flag (primarily from Kaiseretal data, 1-3 scale where 1 is best)

### Processing in Vs30 Pipeline

This dataset is configured in `config.yaml` as:
```yaml
independent_observations_file: observations/measured_vs30_independent_observations.csv
```

**Processing characteristics**:
- **No spatial clustering**: Each measurement is treated independently
- **Direct model updating**: Each observation updates the categorical model at its exact location
- **Bayesian integration**: Uses `update_with_independent_data()` function in the category module
- **Output layers**: Contributes to `posterior_mean_vs30_km_per_s_independent_observations` and related uncertainty layers

### Quality Considerations

- **McGann/Wotherspoon**: High-quality surface wave measurements from specific studies
- **Kaiseretal filtering**: Removes potentially unreliable measurements while preserving known good stations
- **Uncertainty**: Most measurements have uncertainty ~0.2 m/s, though some Kaiseretal sites may have different values
- **Spatial coverage**: Primarily focused on Canterbury region with some nationwide Kaiseretal coverage

### Related Files

- **`measured_vs30_independent_observations_unfiltered.csv`**: Same data sources but includes ALL Kaiseretal sites (not used in main pipeline)
- **`measured_vs30_cpt.csv`**: CPT-derived measurements processed with spatial clustering

### Generation

This file is generated by running:
```bash
python vs30/temp/export_measured_vs30.py
```

The script loads data from the raw sources, applies filtering, adds source labels, and exports to CSV format.