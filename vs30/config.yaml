# Vs30 config file

# --- Grid Parameters ---
# For tiny domain
grid_xmin: 1570050
grid_xmax: 1571050
grid_ymin: 5180050
grid_ymax: 5181050
grid_dx: 100
grid_dy: 100

# For full NZ domain
# grid_xmin: 1060050
# grid_xmax: 2120050
# grid_ymin: 4730050
# grid_ymax: 6250050
# grid_dx: 100
# grid_dy: 100



# --- Full New Zealand Land Extent Bounds (for coastal distance calculations) ---
# IMPORTANT: These values define the full extent of New Zealand land coverage
# and MUST NOT be changed. They are used to ensure coastal distance calculations
# are computed on the full NZ land extent, regardless of the configured study
# domain bounds (grid_xmin/max/ymin/max above). This is critical because:
# 1. Observations used in MVN spatial adjustment may fall anywhere within NZ
# 2. Coastal distances must be accurate for all observation locations
# 3. Computing distances only on a small domain leads to incorrect values for
#    observations outside that domain, causing errors in MVN calculations
# These bounds match the legacy _full_land_grid() function behavior
full_nz_land_xmin: 1060050
full_nz_land_xmax: 2120050
full_nz_land_ymin: 4730050
full_nz_land_ymax: 6250050

# --- NoData and Placeholder Values ---
id_nodata: 255
slope_nodata: -9999
model_nodata: -32767

# --- filenames and Prefixes ---
posterior_prefix: "posterior_"
terrain_initial_vs30_filename: "initial_terrain_vs30_with_uncertainty.tif"
geology_initial_vs30_filename: "initial_geology_vs30_with_uncertainty.tif"
slope_raster_filename: "slope.tif"
coast_distance_raster_filename: "coast_distance.tif"
geology_vs30_slope_and_coastal_distance_adjusted_filename: "geology_vs30_slope_and_coastal_distance_adjusted_with_uncertainty.tif"
geology_id_filename: "gid.tif"
terrain_id_filename: "tid.tif"

# Final output filenames (after spatially adjusting by the fitted multivariate normal distribution (MVN))
terrain_vs30_mean_stddev_filename: "terrain_vs30_spatially_adjusted_with_uncertainty.tif"
geology_vs30_mean_stddev_filename: "geology_vs30_slope_and_coastal_distance_and_spatially_adjusted_with_uncertainty.tif"
combined_vs30_filename: "weighted_combination_of_geology_vs30_after_slope_and_coastal_distance_and_spatial_adjustment_and_terrain_vs30_after_spatial_adjustment.tif"

# --- General Configuration ---

# Whether to perform Bayesian update of geology and terrain categorical vs30 values
do_bayesian_update_of_geology_and_terrain_categorical_vs30_values: true

# Maximum distance (meters) for considering observations
max_dist_m: 10000

# Maximum number of observations to consider per pixel
max_points: 500


# Covariance reduction factor
cov_reduc: 1.5

# Whether measurements are noisy (affects noise weighting)
noisy: true

# Correlation length parameters (in meters)
phi_geology: 1407
phi_terrain: 993

# Maximum memory in GB for spatial boolean arrays during chunked processing
# Note: Total process memory usage will be several GB more than this limit
# due to raster data, observation arrays, and other data structures
max_spatial_boolean_array_memory_gb: 3

# Parameters for Bayesian updates
n_prior: 3  # Assume prior model made up of n_prior measurements
min_sigma: 0.5  # Minimum standard deviation allowed
min_group: 5  # Minimum number of points in a group for DBSCAN update
eps: 15000.0  # Threshold for Bayesian update
# Number of processors to use for sklearn.cluster.DBSCAN clustering algorithm
# This only changes the overall execution time by one or two seconds, as this is a small part of the overall process
nproc_for_dbscan_clustering: 1 # -1 for all available cores (only decreases total pipeline run time by one or two seconds)

# Paths relative to the resources directory
# Observational data that should be treated independently (without clustering)
# Set to "none" to disable, or provide a filename relative to resources directory
independent_observations_file: none
#independent_observations_file: observations/measured_vs30_independent_observations.csv

# Observational data that should be treated with spatial clustering
# Set to "none" to disable, or provide a filename relative to resources directory
#clustered_observations_file : none
clustered_observations_file: observations/measured_vs30_cpt.csv

#output_dir: /tmp/refactored_vs30_output_tiny_domain_independent_observations
output_dir: /tmp/refactored_vs30_output_tiny_domain_clustered_observations
#output_dir: /tmp/refactored_vs30_output_tiny_domain_independent_and_clustered_observations


# Options for geology Vs30 models
# geology_mean_and_standard_deviation_per_category_file: categorical_vs30_mean_and_stddev/geology/geology_model_prior_mean_and_standard_deviation.csv
geology_mean_and_standard_deviation_per_category_file: categorical_vs30_mean_and_stddev/geology/geology_model_posterior_from_foster_2019_mean_and_standard_deviation.csv

# Options for terrain Vs30 models
# terrain_mean_and_standard_deviation_per_category_file: categorical_vs30_mean_and_stddev/terrain/terrain_model_prior_mean_and_standard_deviation.csv
terrain_mean_and_standard_deviation_per_category_file: categorical_vs30_mean_and_stddev/terrain/terrain_model_posterior_from_foster_2019_mean_and_standard_deviation.csv

# Method for combining geology and terrain models
# value can be:
# - float: Ratio of geology weight to terrain weight (e.g. 1.0 = equal weight, 2.0 = geology has 2x weight)
# - string: "standard_deviation_weighting" (uses k_value below)
combination_method: 1.0

# K value for standard deviation based weighting
# Represents the exponent for inverse variance weighting: weight ~ (sigma^2)^-k
# Only used if combination_method is "standard_deviation_weighting"
k_value: 3.0

# Model specific ID columns
model_id_columns:
  geology: gid
  terrain: tid

# --- Parameters for creating the "hybrid" geology Vs30 model that adjusts with slope and coastal distance ---
hybrid_mod6_dist_min: 8000.0
hybrid_mod6_dist_max: 20000.0
hybrid_mod6_vs30_min: 240.0
hybrid_mod6_vs30_max: 500.0

hybrid_mod13_dist_min: 8000.0
hybrid_mod13_dist_max: 20000.0
hybrid_mod13_vs30_min: 197.0
hybrid_mod13_vs30_max: 500.0

# --- Misc ---
min_dist_enforced: 0.1
nztm_crs: "EPSG:2193"

# --- Plotting ---
plot_figsize: [12, 8]
plot_dpi: 300


